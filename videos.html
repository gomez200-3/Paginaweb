<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Nuestros Videos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="style.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
</head>
<body class="emerald-bg">
  <div class="container">
    <h1 class="romantic-title">Nuestros Videos</h1>
    <form id="video-upload-form" class="add-file-control">
      <label class="add-file-label">
        + A침adir video
        <input type="file" id="video-input" accept="video/*" style="display:none" multiple>
      </label>
    </form>
    <div id="video-list" class="video-list"></div>
    <button class="btn-regresar" id="volver-aventuras">(*REGRESAR*)</button>
  </div>
  <!-- Mini reproductor rom치ntico global -->
  <!-- PEGA AQU칈 EL BLOQUE DE mini-player.html -->
  <script>
    function getVideos() {
      return JSON.parse(localStorage.getItem('videos') || '[]');
    }
    function saveVideos(videos) {
      localStorage.setItem('videos', JSON.stringify(videos));
    }
    function renderVideoList() {
      const videoList = document.getElementById('video-list');
      videoList.innerHTML = '';
      const videos = getVideos();
      if (videos.length === 0) {
        videoList.innerHTML = '<p style="color:#fff;font-style:italic;">No has subido ning칰n video a칰n.</p>';
        return;
      }
      videos.forEach((video, idx) => {
        const item = document.createElement('div');
        item.className = 'video-item';
        item.dataset.idx = idx;
        const videoEl = document.createElement('video');
        videoEl.src = video.data;
        videoEl.className = 'video-thumb';
        videoEl.muted = true;
        videoEl.playsInline = true;
        videoEl.preload = "metadata";
        videoEl.style.background = "#222";
        item.appendChild(videoEl);

        // Icono play
        const iconPlay = document.createElement('span');
        iconPlay.className = 'icon-play';
        iconPlay.innerHTML = '郊윒잺';
        iconPlay.style.position = "absolute";
        iconPlay.style.left = "50%";
        iconPlay.style.top = "50%";
        iconPlay.style.transform = "translate(-50%,-50%)";
        item.appendChild(iconPlay);

        // Duraci칩n
        const dur = document.createElement('span');
        dur.className = 'video-nombre';
        dur.innerHTML = '...';
        item.appendChild(dur);

        // Bot칩n borrar
        const btnBorrar = document.createElement('button');
        btnBorrar.className = 'btn-borrar';
        btnBorrar.title = 'Borrar video';
        btnBorrar.innerHTML = '游딈';
        btnBorrar.onclick = (ev) => {
          ev.stopPropagation();
          if (confirm('쯉eguro que quieres borrar este video?')) {
            let videos = getVideos();
            videos.splice(idx, 1);
            saveVideos(videos);
            renderVideoList();
          }
        };
        item.appendChild(btnBorrar);

        videoEl.onloadedmetadata = () => {
          const d = Math.floor(videoEl.duration);
          dur.textContent = d>=60 ? `${Math.floor(d/60)}:${(d%60).toString().padStart(2, '0')}` : `0:${(d%60).toString().padStart(2, '0')}`;
        };

        videoList.appendChild(item);
      });
    }
    document.getElementById('video-input').addEventListener('change', function(e) {
      const files = Array.from(e.target.files);
      if (files.length === 0) return;
      let videos = getVideos();
      let filesToLoad = files.length;
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = function(evt) {
          videos.push({
            name: file.name,
            data: evt.target.result
          });
          filesToLoad--;
          if (filesToLoad === 0) {
            saveVideos(videos);
            renderVideoList();
          }
        };
        reader.readAsDataURL(file);
      });
      e.target.value = "";
    });
    document.getElementById('volver-aventuras').onclick = function() {
      window.location = "aventuras.html";
    };
    window.addEventListener('DOMContentLoaded', renderVideoList);
  </script>
  <!-- PEGA AQU칈 mini-player.html -->
</body>
</html>
