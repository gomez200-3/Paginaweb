<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Te la dedico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="style.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
</head>
<body class="emerald-bg">
  <div class="container">
    <h1 class="romantic-title">
      <span class="emoji" style="color:#a259f7;">🎶</span>
      Te la dedico
      <span class="emoji" style="color:#a259f7;">🎶</span>
    </h1>
    <button class="btn-romantic-round" id="add-music-btn">Añadir música</button>
    <form id="nombre-cancion-form" style="margin:1em 0; display:none;">
      <input type="file" id="musica-input" accept="audio/*" required>
      <input type="text" id="nombre-personalizado" placeholder="¿Cómo quieres llamarla?" required>
      <button type="submit" class="btn-romantic-round" style="padding:0.7em 2em;">Guardar</button>
    </form>
    <div class="musica-lista" id="musica-lista"></div>
    <button class="btn-regresar" id="volver-menu-musica">(*REGRESAR*)</button>
  </div>
  <!-- Mini reproductor romántico global aquí -->
  <div id="mini-player-modal" style="display:none;">
    <button class="close-player" title="Cerrar">✖️</button>
    <img id="mini-player-cover" src="cover1.jpg" alt="Portada">
    <div class="player-title" id="mini-player-title">Canción romántica</div>
    <div class="player-controls">
      <button id="btn-prev" title="Anterior">🚀</button>
      <button id="btn-play" title="Play/Pause">🛸</button>
      <button id="btn-next" title="Siguiente">🪐</button>
    </div>
    <audio id="mini-player-audio"></audio>
  </div>
  <script>
    // Mostrar formulario para añadir música
    document.getElementById('add-music-btn').onclick = function() {
      document.getElementById('nombre-cancion-form').style.display = 'block';
    };
    // Guardar música en LocalStorage
    document.getElementById('nombre-cancion-form').onsubmit = function(e) {
      e.preventDefault();
      const fileInput = document.getElementById('musica-input');
      const nombre = document.getElementById('nombre-personalizado').value.trim();
      if(fileInput.files.length && nombre) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          let lista = JSON.parse(localStorage.getItem('musicas') || '[]');
          lista.push({nombre, data: evt.target.result});
          localStorage.setItem('musicas', JSON.stringify(lista));
          renderMusicaLista();
        };
        reader.readAsDataURL(fileInput.files[0]);
        fileInput.value = '';
        document.getElementById('nombre-personalizado').value = '';
        document.getElementById('nombre-cancion-form').style.display = 'none';
      }
    };
    function renderMusicaLista() {
      const lista = JSON.parse(localStorage.getItem('musicas') || '[]');
      const div = document.getElementById('musica-lista');
      div.innerHTML = '';
      if(lista.length === 0) {
        div.innerHTML = '<span class="mensaje-romantico">No has añadido música aún.</span>';
        return;
      }
      lista.forEach((musica, idx) => {
        const item = document.createElement('div');
        item.className = 'musica-item';
        item.innerHTML = `
          <span>${musica.nombre}</span>
          <audio controls src="${musica.data}" style="max-width:90px; vertical-align:middle;"></audio>
          <button class="btn-borrar" title="Borrar">🗑</button>
        `;
        item.querySelector('.btn-borrar').onclick = function() {
          if(confirm('¿Seguro que deseas borrar esta canción?')) {
            let lista = JSON.parse(localStorage.getItem('musicas') || '[]');
            lista.splice(idx,1);
            localStorage.setItem('musicas', JSON.stringify(lista));
            renderMusicaLista();
          }
        };
        div.appendChild(item);
      });
    }
    document.getElementById('volver-menu-musica').onclick = function() { window.location = "aventuras.html"; };
    window.addEventListener('DOMContentLoaded', renderMusicaLista);

    // --- MINI REPRODUCTOR COPIA TU SCRIPT GLOBAL AQUÍ ---
    // (Pega aquí el mismo JS del reproductor global que ya tienes funcionando)
  </script>
</body>
</html>
