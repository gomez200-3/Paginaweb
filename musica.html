<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Te la dedico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="style.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
</head>
<body class="emerald-bg">
  <div class="container">
    <h1 class="romantic-title">
      <span style="margin-right:0.4em;">ðŸŽ¶</span>Te la dedico<span style="margin-left:0.4em;">ðŸŽ¶</span>
    </h1>
    <button class="btn-principal" id="add-music-btn">AÃ±adir mÃºsica</button>
    <form id="nombre-cancion-form" style="margin:1em 0; display:none;">
      <input type="file" id="musica-input" accept="audio/*" style="margin-bottom:0.5em;" required>
      <input type="text" id="nombre-personalizado" placeholder="Â¿CÃ³mo quieres llamarla?" required>
      <button type="submit" class="btn-principal" style="padding:0.5em 1.2em;">Guardar</button>
    </form>
    <div class="musica-lista" id="musica-lista"></div>
    <button class="btn-regresar" id="volver-menu-musica">(*REGRESAR*)</button>
  </div>
  <script>
    // Mostrar formulario para aÃ±adir mÃºsica
    document.getElementById('add-music-btn').onclick = function() {
      document.getElementById('nombre-cancion-form').style.display = 'block';
    };

    // Guardar mÃºsica con nombre personalizado en localStorage
    document.getElementById('nombre-cancion-form').onsubmit = function(e) {
      e.preventDefault();
      const fileInput = document.getElementById('musica-input');
      const nombre = document.getElementById('nombre-personalizado').value.trim();
      if(fileInput.files.length && nombre) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          let lista = JSON.parse(localStorage.getItem('musicas') || '[]');
          lista.push({nombre, data: evt.target.result});
          localStorage.setItem('musicas', JSON.stringify(lista));
          renderMusicaLista();
        };
        reader.readAsDataURL(fileInput.files[0]);
        fileInput.value = '';
        document.getElementById('nombre-personalizado').value = '';
        document.getElementById('nombre-cancion-form').style.display = 'none';
      }
    };

    function renderMusicaLista() {
      const lista = JSON.parse(localStorage.getItem('musicas') || '[]');
      const div = document.getElementById('musica-lista');
      div.innerHTML = '';
      if(lista.length === 0) {
        div.innerHTML = '<span style="color:#fff;font-style:italic;">No has aÃ±adido mÃºsica aÃºn.</span>';
        return;
      }
      lista.forEach((musica, idx) => {
        const item = document.createElement('div');
        item.className = 'musica-item';
        item.innerHTML = `
          <span>${musica.nombre}</span>
          <audio controls src="${musica.data}" style="max-width:90px; vertical-align:middle;"></audio>
          <button class="btn-borrar" title="Borrar">ðŸ—‘</button>
        `;
        item.querySelector('.btn-borrar').onclick = function() {
          if(confirm('Â¿Seguro que deseas borrar esta canciÃ³n?')) {
            let lista = JSON.parse(localStorage.getItem('musicas') || '[]');
            lista.splice(idx,1);
            localStorage.setItem('musicas', JSON.stringify(lista));
            renderMusicaLista();
          }
        };
        div.appendChild(item);
      });
    }

    document.getElementById('volver-menu-musica').onclick = function() { window.location = "aventuras.html"; };
    window.addEventListener('DOMContentLoaded', renderMusicaLista);
  </script>
</body>
</html>
